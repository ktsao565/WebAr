<!DOCTYPE html>
<html>
  <body>
    <button id="start">Start</button>
    <button id="stop">Stop</button>
    <video id="recorder" autoplay></video>
    <canvas id="canvas"></canvas>

    <script>
        const record = document.getElementById('start');
const stop = document.getElementById('stop');
const video = document.getElementById('recorder');
const video1 = document.getElementById('player');
const canvas = document.getElementById('canvas');
video.setAttribute('controls', '');

const chunks = [];

const constraints = {video: true};

const websocket = new WebSocket('ws://localhost:8000/');

const onSuccess = function(stream) {
  video.srcObject = stream;
  video.onloadedmetadata = function(e) {
           video.play();
         };
  const mediaRecorder = new MediaRecorder(stream);

  record.onclick = function() {
    chunks = [];
    mediaRecorder.start(1000);
    console.log("recorder started");
  }

  stop.onclick = function() {
    mediaRecorder.stop();
    console.log("recorder stopped");
  }

  mediaRecorder.ondataavailable = function(e) {
    console.log("data available");
    console.log(e);

    websocket.send(e.data);
    //const blob = new Blob(e.data, { 'type' : 'video/ogv; codecs=opus' });
    //video1.src = window.URL.createObjectURL(e.data);
  }

  mediaRecorder.onstop = function(e) {
    console.log('onstop fired');
    //const blob = new Blob(chunks, { 'type' : 'video/ogv; codecs=opus' });
    //video1.src = window.URL.createObjectURL(blob);
  };

  mediaRecorder.onwarning = function(e) {
    console.log('onwarning fired');
  };

  mediaRecorder.onerror = function(e) {
    console.log('onerror fired');
  };
};

const onError = function(err) {
  console.log('The following error occured: ' + err);
}
document.addEventListener('DOMContentLoaded', function(event) {
    navigator.getUserMedia  = navigator.getUserMedia ||
                          navigator.webkitGetUserMedia ||
                          navigator.mozGetUserMedia ||
                          navigator.msGetUserMedia;
    navigator.getUserMedia(constraints, onSuccess, onError);
});

    </script>
  </body>
</html>